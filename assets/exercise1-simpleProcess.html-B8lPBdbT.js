import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as l,b as o,e as r,f as a,d as t,a as i,r as c,o as d}from"./app-CJIENTLq.js";const h={};function p(u,e){const s=c("RouteLink");return d(),l("div",null,[o("p",null,[r(s,{to:"/oldstable/tutorial/prerequisites.html"},{default:a(()=>e[0]||(e[0]=[t("Prerequisites")])),_:1}),e[6]||(e[6]=t(" | Exercise 1 | ")),r(s,{to:"/oldstable/tutorial/exercise11-processDebugging.html"},{default:a(()=>e[1]||(e[1]=[t("Exercise 1.1")])),_:1}),e[7]||(e[7]=t(" | ")),r(s,{to:"/oldstable/tutorial/exercise2-inputParameters.html"},{default:a(()=>e[2]||(e[2]=[t("Exercise 2")])),_:1}),e[8]||(e[8]=t(" | ")),r(s,{to:"/oldstable/tutorial/exercise3-messageEvents.html"},{default:a(()=>e[3]||(e[3]=[t("Exercise 3")])),_:1}),e[9]||(e[9]=t(" | ")),r(s,{to:"/oldstable/tutorial/exercise4-exclusiveGateways.html"},{default:a(()=>e[4]||(e[4]=[t("Exercise 4")])),_:1}),e[10]||(e[10]=t(" | ")),r(s,{to:"/oldstable/tutorial/exercise5-eventBasedGateways.html"},{default:a(()=>e[5]||(e[5]=[t("Exercise 5")])),_:1})]),e[32]||(e[32]=i('<h2 id="exercise-1-simple-process" tabindex="-1"><a class="header-anchor" href="#exercise-1-simple-process"><span>Exercise 1 - Simple Process</span></a></h2><p>The first exercise focuses on setting up the testing environment used in this tutorial and shows how to implement and execute a simple BPMN process.</p><p>With this exercise we will take a look at the general setup of the tutorial code base, modify a service class and execute the service within a simple demo process.</p><h3 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction"><span>Introduction</span></a></h3><hr><h4 id="tutorial-code-base-structure-and-docker-test-setup" tabindex="-1"><a class="header-anchor" href="#tutorial-code-base-structure-and-docker-test-setup"><span>Tutorial Code Base Structure and Docker Test Setup</span></a></h4><p>The tutorial project consists of three parts: A <code>test-data-generator</code> project used to generate X.509 certificates and FHIR resources during the maven build of the project. The certificates and FHIR resources are needed to start DSF instances simulating installations at three different organizations used for this tutorial. The DSF instances are configured using a <code>docker-compose.yml</code> file in the <code>test-setup</code> folder. The docker-compose test setup uses a single PostgreSQL database server, a single nginx reverse proxy as well as three separate DSF FHIR server- and 3 separate DSF BPE server instances. The <code>tutorial-process</code> project contains all resource (FHIR resources, BPMN process models and Java code) for the actual DSF process plugin.</p><p>Java code for the <code>tutorial-process</code> project is located at <code>src/main/java</code>, FHIR resources and BPMN process models at <code>src/main/resources</code> as well as prepared JUnit tests to verify your solution at <code>src/test/java</code>.</p><h4 id="process-plugin-main-components" tabindex="-1"><a class="header-anchor" href="#process-plugin-main-components"><span>Process Plugin Main Components</span></a></h4><p>The most imported Java class used to specify the process plugin for the DSF BPE server is a class that implements the <code>org.highmed.dsf.bpe.ProcessPluginDefinition</code> interface from the DSF <a href="https://github.com/highmed/highmed-dsf/packages/503054" target="_blank" rel="noopener noreferrer">dsf-bpe-process-base</a> module. The DSF BPE server searches for classes implementing this interface using the Java <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ServiceLoader.html" target="_blank" rel="noopener noreferrer">ServiceLoader</a> mechanism. For this tutorial the <code>TutorialProcessPluginDefinition</code> class implements this interface. It is appropriately specified in the <code>src/main/resources/META-INF/services/org.highmed.dsf.bpe</code>.ProcessPluginDefinition file. The <code>TutorialProcessPluginDefinition</code> class is used to specify name and version of the process plugin, what BPMN processes are to be deployed and what FHIR resources and required by the BPMN processes. For the implementation of service task and message events of the processes a special Spring context is used for every process plugin. The <code>TutorialProcessPluginDefinition</code> class specifies what via <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-basic-concepts" target="_blank" rel="noopener noreferrer">Spring-Framework configuration class</a> with Spring Beans are used for the process plugin specific Spring Context. For this plugin the <code>TutorialConfig</code> cass is used to define Spring Beans.</p><p>The business process engine used by the DSF BPE server is based on the OpenSource Camunda Process Engine 7. In order to specify what Java code should be executed for a BPMN <a href="https://docs.camunda.org/manual/7.17/reference/bpmn20/tasks/service-task/" target="_blank" rel="noopener noreferrer">ServiceTask</a> you need to specify the fully-qualified Java class name in the ServiceTask inside the BPMN model. To be executable the Java class needs to extend the <code>org.highmed.dsf.bpe.delegate.AbstractServiceDelegate</code> from the DSF <a href="https://github.com/highmed/highmed-dsf/packages/503054" target="_blank" rel="noopener noreferrer">dsf-bpe-process-base</a> module and the class needs to be defined as as Spring Bean.</p><h4 id="process-execution-and-fhir-task-resources" tabindex="-1"><a class="header-anchor" href="#process-execution-and-fhir-task-resources"><span>Process Execution and FHIR Task Resources</span></a></h4><p>Business process instances are started or the execution continued via FHIR <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resources. The <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resource specifies what process to instantiate or continue, what organization is requesting this action and what organization is the target for the request. When a <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resource starts a process we call it &quot;leading&quot;, when it continues a process it&#39;s called &quot;current&quot;. This differentiation is important for multi-instance use cases not covered by this tutorial. Each Java class extending the abstract class <code>org.highmed.dsf.bpe.delegate.AbstractServiceDelegate</code> has methods to access both types of <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resources.</p><h4 id="process-access-control" tabindex="-1"><a class="header-anchor" href="#process-access-control"><span>Process Access Control</span></a></h4><p>FHIR <a href="http://hl7.org/fhir/R4/activitydefinition.html" target="_blank" rel="noopener noreferrer">ActivityDefinition</a> resources are used to announce what processes can be instantiated at a given DSF instance. These resources are used by the DSF to specify what profile the <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resource needs to conform to and what BPMN message name is used to correlate the appropriate start or intermediate event within the BPMN model. The <a href="http://hl7.org/fhir/R4/activitydefinition.html" target="_blank" rel="noopener noreferrer">ActivityDefinition</a> also defines what kind of organization can request the instantiation or continuation of a process instance and what kind of organization are allowed to fulfill the request.</p>',15)),o("p",null,[e[13]||(e[13]=t("We will take a closer look as ")),e[14]||(e[14]=o("a",{href:"http://hl7.org/fhir/R4/activitydefinition.html",target:"_blank",rel:"noopener noreferrer"},"ActivityDefinition",-1)),e[15]||(e[15]=t(" resources in ")),r(s,{to:"/oldstable/tutorial/exercise3-messageEvents.html"},{default:a(()=>e[11]||(e[11]=[t("Exercise 3")])),_:1}),e[16]||(e[16]=t(" and ")),r(s,{to:"/oldstable/tutorial/exercise5-eventBasedGateways.html"},{default:a(()=>e[12]||(e[12]=[t("Exercise 5")])),_:1}),e[17]||(e[17]=t("."))]),e[33]||(e[33]=i('<h3 id="exercise-tasks" tabindex="-1"><a class="header-anchor" href="#exercise-tasks"><span>Exercise Tasks</span></a></h3><hr><ol><li>Add a log message to the <code>HelloDic#doExecute</code> method that logs the recipient organization identifier from the &quot;leading&quot; Task.</li><li>Register the <code>HelloDic</code> class as a singleton bean in the TutorialConfig class.</li><li>Set the HelloDic class as the service implementation of the appropriate service task within the <code>hello-dic.bpmn</code> process model.</li><li>Modify the ActivityDefinition for the <code>highmedorg_helloDic</code> process to only allow local clients to instantiate the process via a <code>helloDic</code> message.</li></ol><h3 id="solution-verification" tabindex="-1"><a class="header-anchor" href="#solution-verification"><span>Solution Verification</span></a></h3><hr><h4 id="maven-build-and-automated-tests" tabindex="-1"><a class="header-anchor" href="#maven-build-and-automated-tests"><span>Maven Build and Automated Tests</span></a></h4><p>Execute a maven build of the dsf-process-tutorial parent module via:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>mvn clean install -Pexercise-1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Verify that the build was successful and no test failures occurred.</p><h4 id="process-execution-and-manual-tests" tabindex="-1"><a class="header-anchor" href="#process-execution-and-manual-tests"><span>Process Execution and Manual Tests</span></a></h4><p>To verify the <code>highmedorg_helloDic</code> process can be executed successfully, we need to deploy it into a DSF instance and execute the process. The maven <code>install</code> build is configured to create a process jar file with all necessary resources and to copy the jar to the appropriate locations of the docker test setup.</p><ol><li>Start the DSF FHIR server for the <code>Test_DIC</code> organization in a console at location <code>.../dsf-process-tutorial/test-setup</code>:</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up dic-fhir</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Verify the DSF FHIR server started successfully. You can access the webservice of the DSF FHIR server at <a href="https://dic/fhir" target="_blank" rel="noopener noreferrer">https://dic/fhir</a>.<br> The DSF FHIR server uses a server certificate that was generated during the first maven install build. To authenticate yourself to the server you can use the client certificate located at <code>.../dsf-process-tutorial/test-data-generator/cert/Webbrowser_Test_User/Webbrowser_Test_User_certificate.p12</code> (Password: password). Add the certificate and the generated Root CA to your browser certificate store.</p><p>Caution: If you add the generated Root CA to your browsers certificate store as a trusted Root CA, make sure you are the only one with access to the private key at <code>.../dsf-process-tutorial/test-data-generator/cert/ca/testca_private-key.pem</code>.</p><ol start="2"><li>Start the DSF BPE server for the <code>Test_DIC</code> organization in a second console at location <code>.../dsf-process-tutorial/test-setup</code>:</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up dic-bpe</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Verify the DSF BPE server started successfully and deployed the highmedorg_helloDic process. The DSF BPE server should print a message that the process was deployed. The DSF FHIR server should now have a new ActivityDefinition resource. Go to <a href="https://dic/fhir/ActivityDefinition" target="_blank" rel="noopener noreferrer">https://dic/fhir/ActivityDefinition</a> to check if the expected resource was created by the BPE while deploying the process. The returned FHIR Bundle should contain a single ActivityDefinition. Also, go to <a href="https://dic/fhir/StructureDefinition?url=http://highmed.org/fhir/StructureDefinition/task-hello-dic" target="_blank" rel="noopener noreferrer">https://dic/fhir/StructureDefinition?url=http://highmed.org/fhir/StructureDefinition/task-hello-dic</a> to check if the expected Task profile was created.</p><ol start="3"><li>Start the <code>highmedorg_helloDic</code> process by posting an appropriate FHIR <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resource to the DSF FHIR server:</li></ol><p>The <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resource is used to tell the DSF BPE server via the DSF FHIR server that a specific organization wants to start (or continue) one process instance at a specified organization. The needed <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resource can be generated and posted to the DSF FHIR server by executing the <code>main</code> method of the <code>org.highmed.dsf.process.tutorial.TutorialExampleStarter</code> class. For the TutorialExampleStarter to work the location of the client certificate and its password need to be specified:</p><ul><li>Either specify the location and password via program arguments: 1. location of the client certificate (<code>.../dsf-process-tutorial/test-data-generator/cert/Webbrowser_Test_User/Webbrowser_Test_User_certificate.p12</code>), 2. password for the client certificate (<code>password</code>)</li><li>Or set the environment variables <code>DSF_CLIENT_CERTIFICATE_PATH</code> and <code>DSF_CLIENT_CERTIFICATE_PASSWORD</code> with the appropriate values.</li></ul><p>Verify that the FHIR <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resource could be created at the DSF FHIR server. The TutorialExampleStarter class should print a message <code>HTTP 201: Created</code> showing that the <a href="http://hl7.org/fhir/R4/task.html" target="_blank" rel="noopener noreferrer">Task</a> resource was created.</p><p>Verify that the <code>highmedorg_helloDic</code> process was executed by the DSF BPE server. The BPE server should print a message showing that the process was started, print the log message you added to the <code>HelloDic</code> class and end with a message showing that the process finished.</p>',23)),o("p",null,[e[19]||(e[19]=t("Continue with ")),r(s,{to:"/oldstable/tutorial/exercise11-processDebugging.html"},{default:a(()=>e[18]||(e[18]=[t("Exercise 1.1")])),_:1}),e[20]||(e[20]=t("."))]),e[34]||(e[34]=o("hr",null,null,-1)),o("p",null,[r(s,{to:"/oldstable/tutorial/prerequisites.html"},{default:a(()=>e[21]||(e[21]=[t("Prerequisites")])),_:1}),e[27]||(e[27]=t(" | Exercise 1 | ")),r(s,{to:"/oldstable/tutorial/exercise11-processDebugging.html"},{default:a(()=>e[22]||(e[22]=[t("Exercise 1.1")])),_:1}),e[28]||(e[28]=t(" | ")),r(s,{to:"/oldstable/tutorial/exercise2-inputParameters.html"},{default:a(()=>e[23]||(e[23]=[t("Exercise 2")])),_:1}),e[29]||(e[29]=t(" | ")),r(s,{to:"/oldstable/tutorial/exercise3-messageEvents.html"},{default:a(()=>e[24]||(e[24]=[t("Exercise 3")])),_:1}),e[30]||(e[30]=t(" | ")),r(s,{to:"/oldstable/tutorial/exercise4-exclusiveGateways.html"},{default:a(()=>e[25]||(e[25]=[t("Exercise 4")])),_:1}),e[31]||(e[31]=t(" | ")),r(s,{to:"/oldstable/tutorial/exercise5-eventBasedGateways.html"},{default:a(()=>e[26]||(e[26]=[t("Exercise 5")])),_:1})])])}const m=n(h,[["render",p],["__file","exercise1-simpleProcess.html.vue"]]),b=JSON.parse('{"path":"/oldstable/tutorial/exercise1-simpleProcess.html","title":"Exercise 1 - Simple Process","lang":"en-US","frontmatter":{"title":"Exercise 1 - Simple Process","icon":"slides","gitInclude":[]},"headers":[{"level":2,"title":"Exercise 1 - Simple Process","slug":"exercise-1-simple-process","link":"#exercise-1-simple-process","children":[{"level":3,"title":"Introduction","slug":"introduction","link":"#introduction","children":[]},{"level":3,"title":"Exercise Tasks","slug":"exercise-tasks","link":"#exercise-tasks","children":[]},{"level":3,"title":"Solution Verification","slug":"solution-verification","link":"#solution-verification","children":[]}]}],"readingTime":{"minutes":4.59,"words":1376},"filePathRelative":"oldstable/tutorial/exercise1-simpleProcess.md","excerpt":"<p><a href=\\"/oldstable/tutorial/prerequisites.html\\" target=\\"_blank\\">Prerequisites</a> | Exercise 1 | <a href=\\"/oldstable/tutorial/exercise11-processDebugging.html\\" target=\\"_blank\\">Exercise 1.1</a> | <a href=\\"/oldstable/tutorial/exercise2-inputParameters.html\\" target=\\"_blank\\">Exercise 2</a> | <a href=\\"/oldstable/tutorial/exercise3-messageEvents.html\\" target=\\"_blank\\">Exercise 3</a> | <a href=\\"/oldstable/tutorial/exercise4-exclusiveGateways.html\\" target=\\"_blank\\">Exercise 4</a> | <a href=\\"/oldstable/tutorial/exercise5-eventBasedGateways.html\\" target=\\"_blank\\">Exercise 5</a></p>"}');export{m as comp,b as data};
